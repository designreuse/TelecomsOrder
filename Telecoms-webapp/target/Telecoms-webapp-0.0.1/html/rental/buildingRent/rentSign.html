<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>INSPINIA | Wizards</title>

    <link href="../../../css/common/bootstrap.min.css" rel="stylesheet">
    <link href="../../../font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="../../../css/common/animate.css" rel="stylesheet">
    <link href="../../../css/common/plugins/jQueryUI/jquery-ui-1.10.4.custom.min.css" rel="stylesheet">
    <link href="../../../css/common/plugins/jqGrid/ui.jqgrid.css" rel="stylesheet">
    <link href="../../../css/common/plugins/datapicker/datepicker3.css" rel="stylesheet">
    <link href="../../../css/common/plugins/daterangepicker/daterangepicker-bs3.css" rel="stylesheet">
    <link href="../../../css/common/style.css" rel="stylesheet">
    <!-- 弹出框 -->
    <link href="../../../css/common/plugins/sweetalert/sweetalert.css" rel="stylesheet">

    <link href="../../../css/common/plugins/dropzone/basic.css" rel="stylesheet">
    <link href="../../../css/common/plugins/dropzone/dropzone.css" rel="stylesheet">

    <!-- 上传图片 -->
    <link href="../../../css/common/plugins/webuploader/webuploader.css" rel="stylesheet">
    <link href="../../../css/asset/building/uploader.css" rel="stylesheet">
    <link href="../../../css/common/filebox.css" rel="stylesheet">
    <link href="../../../css/rental/buildingRent/filebox.css" rel="stylesheet">
    <link href="../../../css/common/plugins/blueimp/css/blueimp-gallery.min.css" rel="stylesheet">

    <style type="text/css">
        .carousel-control.right {
            background-image: linear-gradient(to right, rgba(255, 255, 255, 1) 0, rgba(0, 0, 0, .0001) 100%);
            width: 0px;
        }

        .carousel-control.left {
            background-image: linear-gradient(to right, rgba(255, 255, 255, 1) 0, rgba(0, 0, 0, .0001) 100%);
            width: 0px;
        }

        .carousel-control .glyphicon-chevron-left, .carousel-control .icon-prev {
            background-color: rgb(136, 133, 133);
        }

        .carousel-control .glyphicon-chevron-right, .carousel-control .icon-next {
            background-color: rgb(136, 133, 133);
        }

        .carousel-control .glyphicon-chevron-left, .carousel-control .glyphicon-chevron-right, .carousel-control .icon-next, .carousel-control .icon-prev {
            margin-top: -35px;
        }

        .rentCommonTruncateCss
        {
            width:280px;
            overflow:hidden;
            text-overflow:ellipsis;
            white-space:nowrap;
        }

        .truncateCss
        {
            overflow:hidden;
            text-overflow:ellipsis;
            white-space:nowrap;
            display: block;
            margin-bottom: 0px;
        }

        #chooseDiv td,th
        {
            vertical-align: middle;
            text-align:center;
        }
    </style>
</head>

<body class="gray-bg">
<div id="applyDiv" class="wrapper wrapper-content animated fadeIn">
    <div class="row">
        <div class="col-lg-12">
            <div id="applyContentId" class="ibox float-e-margins border-bottom">
                <div class="ibox-title">
                    <h5>
                        租赁申请信息
                    </h5>
                    <div class="ibox-tools">
                        <a class="collapse-link">
                            <i class="fa fa-chevron-down">
                            </i>
                        </a>
                    </div>
                </div>
                <div class="ibox-content" style="display:none;">
                    <div class="row">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title" style="border-bottom:1px solid rgb(234, 236, 237);">
                                <h5>
                                    基本信息
                                </h5>
                            </div>
                            <div class="col-sm-12">
                                <form class="form-horizontal m-t">
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                            业务办理人
                                        </label>
                                        <div class="col-sm-9">
                                            <input id="consNameId" disabled="disabled" type="hidden"
                                                   class="form-control"/>
                                            <input id="bizTransactor_id" disabled="disabled" value="" type="text" class="form-control" />
                                        </div>
                                    </div>
                                    <div class="hr-line-dashed"></div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                            联系电话
                                        </label>
                                        <div class="col-sm-9">
                                            <input id="contactTel_id" type="text" disabled="disabled" value="" class="form-control" />
                                        </div>
                                    </div>
                                    <div class="hr-line-dashed">
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                            通讯地址
                                        </label>
                                        <div class="col-sm-9">
                                            <input id="contactAdd_id" type="text" disabled="disabled" value="" class="form-control" />
                                        </div>
                                    </div>
                                    <div class="hr-line-dashed"></div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                            租赁地址
                                        </label>

                                        <div class="col-sm-9">
                                            <input id="consAddr_id" type="text" disabled="disabled"
                                                   class="form-control"/>
                                        </div>
                                    </div>
                                    <div class="hr-line-dashed"></div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                            租赁总面积
                                        </label>

                                        <div class="col-sm-9">
                                            <input id="houseArea_id" type="text" disabled="disabled"
                                                   class="form-control"/>
                                        </div>
                                    </div>
                                    <div class="hr-line-dashed"></div>
                                </form>
                            </div>
                        </div>
                        <div class="ibox float-e-margins  border-bottom">

                            <div class="ibox-title">
                                <h5>
                                    租房及结算方式
                                </h5>

                                <div class="ibox-tools">
                                    <a class="collapse-link">
                                        <i class="fa fa-chevron-down">
                                        </i>
                                    </a>
                                </div>
                            </div>
                            <div class="ibox-content" style="display:none;">
                                <div class="full-height-scroll">
                                    <div class="col-sm-12" style="padding: 5px; margin-botton:0px;">
                                        <div class="jqGrid_wrapper" id="rentInfoTable_id">
                                            <table id="rentInfoTable"></table>
                                            <div id="rentInfoPager"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="ibox float-e-margins" id = "payModeId" style="display: block">
                            <div class="ibox-title" style="border-bottom:1px solid rgb(234, 236, 237);">
                                <h5>
                                    缴费方式
                                </h5>
                            </div>
                            <div class="col-sm-12">
                                <form class="form-horizontal m-t">
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                            缴费方式
                                        </label>

                                        <div class="col-sm-9">
                                            <input type="text" disabled="" class="form-control"
                                                   data-form-un="1447377096628.0225" id="payMode_id"/>
                                        </div>
                                    </div>
                                    <div class="hr-line-dashed">
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                            付款周期
                                        </label>

                                        <div class="col-sm-9">
                                            <input type="text" disabled="" class="form-control"
                                                   data-form-un="1447377096628.0225" id="billCycle_id"/>
                                        </div>
                                    </div>
                                    <div class="hr-line-dashed">
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                            缴费账号
                                        </label>

                                        <div class="col-sm-9">
                                            <input type="text" disabled="" class="form-control"
                                                   data-form-un="1447377096628.0225" id="bankAcct_id"/>
                                        </div>
                                    </div>
                                    <div class="hr-line-dashed">
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                            账户名称
                                        </label>

                                        <div class="col-sm-9">
                                            <input type="text" disabled="" class="form-control"
                                                   data-form-un="1447377096628.0225" id="acctName_id"/>
                                        </div>
                                    </div>
                                    <div class="hr-line-dashed">
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                            开户银行
                                        </label>

                                        <div class="col-sm-9">
                                            <input type="text" disabled="" class="form-control"
                                                   data-form-un="1447377096628.0225" id="bankCode_id"/>
                                        </div>
                                    </div>
                                    <div class="hr-line-dashed">
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                            开户协议号
                                        </label>

                                        <div class="col-sm-9">
                                            <input type="text" disabled="disabled" class="form-control"
                                                   data-form-un="1447377096628.0225"
                                                   id="acctAgmtNo_id"/>
                                        </div>
                                    </div>
                                    <div class="hr-line-dashed">
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                            押金
                                        </label>

                                        <div class="col-sm-9">
                                            <input type="text" disabled="disabled" class="form-control"
                                                   data-form-un="1447377096628.0225" id="deposit_id">
                                                               <span class="help-block m-b-none">
                                                                    <i class="fa fa-info-circle">
                                                                    </i>
                                                                        单位：元
                                                                </span>
                                        </div>
                                    </div>
                                    <div class="hr-line-dashed">
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                            备注
                                        </label>
                                        <div class="col-sm-9">
                                                        <textarea disabled="disabled" name="comment"
                                                                  class="form-control" id="remark_id">
                                                        </textarea>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>


                        <div class="ibox float-e-margins" id = "payModeId1" style="display: block">
                            <div class="ibox-title" style="border-bottom:1px solid rgb(234, 236, 237);">
                                <h5>
                                    缴费方式
                                </h5>
                            </div>
                            <div class="col-sm-12">
                                <form class="form-horizontal m-t">
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                            缴费方式
                                        </label>

                                        <div class="col-sm-9">
                                            <input type="text" disabled="" class="form-control"
                                                   data-form-un="1447377096628.0225" id="payMode_id1"/>
                                        </div>
                                    </div>
                                    <div class="hr-line-dashed">
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                            付款周期
                                        </label>

                                        <div class="col-sm-9">
                                            <input type="text" disabled="" class="form-control"
                                                   data-form-un="1447377096628.0225" id="billCycle_id1"/>
                                        </div>
                                    </div>
                                    <div class="hr-line-dashed">
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                            押金
                                        </label>

                                        <div class="col-sm-9">
                                            <input type="text" disabled="disabled" class="form-control"
                                                   data-form-un="1447377096628.0225" id="deposit_id1">
                                                               <span class="help-block m-b-none">
                                                                    <i class="fa fa-info-circle">
                                                                    </i>
                                                                        单位：元
                                                                </span>
                                        </div>
                                    </div>
                                    <div class="hr-line-dashed">
                                    </div>
                                    <div class="form-group">
                                        <label class="col-sm-2 control-label">
                                            备注
                                        </label>
                                        <div class="col-sm-9">
                                                    <textarea disabled="disabled" name="comment"
                                                              class="form-control" id="remark_id1">
                                                    </textarea>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div id="signsDiv" class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>
                        合同签订
                    </h5>
                    <div class="ibox-tools">
                        <button class="btn btn-primary btn-xs" style="width:100px;height:25px;margin-right: 100px;" onclick="showChooseDiv();">生成付款通知单</button>
                    </div>
                </div>
                <div class="ibox-content">
                    <div class="project-list">
                        <div class="table-responsive">
                            <table id="signTable" class="table table-hover">
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<div id="chooseDiv" class="wrapper wrapper-content animated fadeIn" style="display: none;">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins border-bottom">
                <div class="ibox-title">
                    <h5>
                        付款通知单
                    </h5>
                    <div class="ibox-tools">
                        <button class="btn btn-primary btn-xs" style="width:60px;height:25px;" onclick="backToApplyDiv();">返回</button>
                        <button class="btn btn-primary btn-xs" style="width:60px;height:25px;margin-right:20px;" onclick="printScreen()">打印</button>
                    </div>
                </div>

                <div id="chooseDivBody" class="ibox-content">
                    <h2 style="text-align: center;">
                        付款通知单
                    </h2>
                    <h5>XXX公司：</h5>
                    <br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;请按照扣款日期完成租金及押金所有款项的付款。<br/>
                    <br/>&nbsp;&nbsp;&nbsp;&nbsp;附：付款详情<br/>
                    <div class="col-sm-12">
                        <table class="table table-striped table-bordered table-hover dataTables-example" >
                            <tr>
                                <td>合同编号</td>
                                <td colspan="2">234233234 </td>
                                <td>租赁地址</td>
                                <td colspan="2">XXX栋XXX层 </td>
                            </tr>
                            <tr>
                                <td>租赁面积(m²)</td>
                                <td colspan="2">第一行的第二、三栏 </td>
                                <td>租赁时间</td>
                                <td colspan="2">第一行的第二、三栏 </td>
                            </tr>
                            <tr>
                                <td>序号</td>
                                <td>金额(元)</td>
                                <td>扣款日期</td>
                                <td>序号</td>
                                <td>金额(元)</td>
                                <td>扣款日期</td>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>2123</td>
                                <td>2015-12-05</td>
                                <td>4</td>
                                <td>214124</td>
                                <td>2015-12-05</td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>2424</td>
                                <td>2015-12-05</td>
                                <td>5</td>
                                <td>24124</td>
                                <td>2015-12-05</td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>234234</td>
                                <td>2015-12-05</td>
                                <td>6</td>
                                <td>234234</td>
                                <td>2015-12-05</td>
                            </tr>
                        </table>
                    </div>
                    <br/>押金：XX元
                    <br/>合计：XX元
                    <br/>实际应缴纳：XX元
                    <br>
                    　请贵公司接到本通知后，按合同予以结算。如有特殊情况，望及时与我公司财务部联系（联系方式：ＸＸＸＸＸＸＸ）。
                </div>

            </div>
        </div>
    </div>
</div>
</div>


<div id="signDiv" class="wrapper wrapper-content animated fadeIn" style="display:none;">
    <div class="ibox float-e-margins">
        <div class="ibox-title"  style="border-bottom:1px solid #f3f3f4;">
            <h5>
                合同信息
            </h5>
            <div class="ibox-tools">
                <a class="collapse-link">
                    <i class="fa fa-chevron-down">
                    </i>
                </a>
            </div>
        </div>
        <div class="ibox-content  col-sm-12" style="display:none;">
            <div class="col-sm-12" style="background-color: #fff;">
                <form class="form-horizontal m-t" id="draftForm">
                    <div class="form-group">
                        <label class="col-sm-2 control-label">
                            合同名称
                        </label>

                        <div class="col-sm-9">
                            <input type="hidden" id="contractId">
                            <input id="contractName" name="contractName" disabled="disabled" maxlength="256" type="text" class="form-control">
                        </div>
                    </div>
                    <div class="hr-line-dashed">
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">
                            出租方(甲方)
                        </label>

                        <div class="col-sm-9">
                            <input id="contractOwner" name="contractOwner" disabled="disabled" maxlength="64" type="text" class="form-control">
                        </div>
                    </div>
                    <div class="hr-line-dashed">
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label">
                            承租方(乙方)
                        </label>

                        <div class="col-sm-9">
                            <input id="contractGuest" name="contractGuest" disabled="disabled" maxlength="64" type="text" class="form-control">
                        </div>
                    </div>
                    <div id="imgTopHr" class="hr-line-dashed"></div>

                    <div id="img-group">
                        <div class="form-group">
                            <label class="col-sm-2 control-label"></label>
                            <div class="col-sm-10">
                                <div id="filebox">
                                    <ul class="filelist lightBoxGallery">

                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="ibox float-e-margins">
        <div class="ibox-title"  style="border-bottom:1px solid #f3f3f4;">
            <h5>
                签订信息
            </h5>
            <div class="ibox-tools">
                <button id="backBtn"  class="btn btn-primary btn-xs" style="width:60px;height:25px;" onclick="backToMainDivSign();">返回</button>
                <button id="saveBtn" class="btn btn-primary btn-xs" style="width:60px;height:25px;" onclick="save();">保存</button>
            </div>
        </div>
                <div class="col-sm-12" style="background-color: #fff;height: 1000px;">
            <form class="form-horizontal m-t" id="signForm">
                <div class="form-group">
                    <label class="col-sm-2 control-label">
                        合同甲方经办人<font style="color:red;">*</font>
                    </label>
                            <div class="col-sm-10">
                        <input type="hidden" id="contractIdSign">
                        <input type="hidden" id="attachIdsIn" name="attachIds" value="">
                        <input id="partyAperson" name="partyAperson" maxlength="64"  type="text"  value="" class="form-control" data-form-un="1447377096628.0225">
                    </div>
                </div>
                <div class="hr-line-dashed">
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">
                        合同乙方经办人<font style="color:red;">*</font>
                    </label>
                            <div class="col-sm-10">
                        <input id="partyBperson" name="partyBperson" maxlength="64"  type="text"  value="" class="form-control" data-form-un="1447377096628.0225">
                    </div>
                </div>
                <div class="hr-line-dashed">
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">
                        签订日期<font style="color:red;">*</font>
                    </label>
                            <div class="col-sm-10">
                        <input  class="laydate-icon" id="start" name="start" style="width:100%;display:inline;height:34px;padding-left:20px;margin-right: 2px;border-color:#E5E6E7;"
                                placeholder="YYYY-MM-DD" />
                    </div>
                </div>
                <div class="hr-line-dashed">
                </div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">
                        签订地址<font style="color:red;">*</font>
                    </label>
                            <div class="col-sm-10">
                        <input id="signAdd" name="signAdd" maxlength="256"  type="text"  value="" class="form-control" data-form-un="1447377096628.0225">
                    </div>
                </div>

                <div id="imgTopHrSign" class="hr-line-dashed"></div>

                <div id="img-groupSign">
                    <div class="form-group">
                        <label class="col-sm-2 control-label">企业证件照</label>
                        <div class="col-sm-10">
                            <div id="fileboxSign">
                                <ul class="filelist lightBoxGallery">

                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="uploader" class="wu-example">
                    <div class="queueList">
                        <div id="dndArea" class="placeholder">
                            <div id="filePicker"></div>
                            <p>或将照片拖到这里，最多可选5张</p>
                        </div>
                    </div>
                    <div class="statusBar" style="display:none;">
                        <div class="progress">
                            <span class="text">0%</span>
                            <span class="percentage"></span>
                        </div><div class="info"></div>
                        <div class="btns">
                            <div id="filePicker2"></div><div class="uploadBtn">开始上传</div>
                        </div>
                    </div>
                </div>

                <div id="accPlanTopHrSign" class="hr-line-dashed"></div>

                <div id="accPlanTopHrSignView" class="form-group">
                    <div class="col-sm-12" style="padding: 5px; margin-botton:0px;">
                        <div class="jqGrid_wrapper" id="acctPlanTable_id">
                            <table id="acctPlanTable"></table>
                            <div id="acctPlanPager"></div>
                        </div>
                    </div>
                </div>

            </form>
        </div>
    </div>
</div>



<!-- Mainly scripts -->
<script src="../../../js/common/jquery-2.1.1.js"></script>

<!-- 打印 -->
<script src="../../../js/rental/jquery-migrate-1.1.0.js"></script>
<script src="../../../js/rental/jquery.jqprint-0.3.js"></script>

<script src="../../../js/common/bootstrap.min.js"></script>
<script src="../../../js/common/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="../../../js/common/plugins/slimscroll/jquery.slimscroll.min.js"></script>\

<!-- Custom and plugin javascript -->
<script src="../../../js/common/inspinia.js"></script>
<script src="../../../js/common/plugins/pace/pace.min.js"></script>

<!-- Steps -->
<script src="../../../js/common/plugins/staps/jquery.steps.min.js"></script>

<!-- Jquery Validate -->
<script src="../../../js/common/plugins/validate/jquery.validate.min.js"></script>

<!--script src="../../../js/rental/laydate-master/test/demo2.js"></script-->
<script src="../../../js/rental/laydate-master/laydate.js"></script>

<!-- 弹出框 -->
<script src="../../../js/common/plugins/sweetalert/sweetalert.min.js"></script>
<script src="../../../js/common/common.js"></script>

<script src="../../../js/common/plugins/jqGrid/jquery.jqGrid.min.js"></script>
<script src="../../../js/common/plugins/jqGrid/i18n/grid.locale-cn.js"></script>

<script src="../../../js/common/plugins/dataTables/jquery.dataTables.js"></script>
<script src="../../../js/common/plugins/layer/layer.js"></script>
        <script src="../../../js/common/jquery-ui-1.10.4.min.js"></script>
        <script src="../../../js/common/plugins/fullcalendar/moment.min.js"></script>
        <script src="../../../js/common/plugins/datapicker/bootstrap-datepicker.js"></script>
        <script src="../../../js/common/plugins/daterangepicker/daterangepicker.js"></script>
        <!--<script src="../../../js/common/plugins/jquery-ui/i18n/jquery.ui.datepicker-zh-CN.min.js"></script>-->



<script>
    var appNo = "";
    var uploaderParam = {
        uploadServer: '/rentalDraft/rental/upload',
        fileNumLimit: 5
    };

    function init(params) {
        appNo = params.bizKey;

        queryRentInfo();

        queryHistory();

        queryRentInfoForSign();

        return function (){

            saveProcess();
        };
    }

    $.validator.setDefaults({
        highlight: function(e) {
            $(e).closest(".form-group").removeClass("has-success").addClass("has-error")
        },
        success: function(e) {
            e.closest(".form-group").removeClass("has-error").addClass("has-success")
        },
        errorElement: "span",
        errorPlacement: function(e, r) {
            e.appendTo(r.is(":radio") || r.is(":checkbox") ? r.parent().parent().parent() : r.parent())
        },
        errorClass: "help-block m-b-none",
        validClass: "help-block m-b-none"
    },{
        debug:true
    }),$(function() {

        $(window).bind("resize",
                function() {
                    var width = $("#rentInfoTable_id").width();
                    $("#rentInfoTable").setGridWidth(width);
                })

        var e = "<i class='fa fa-times-circle'></i> ";
        $("#signForm").validate({
            rules: {
                partyAperson: {
                    required:true
                },
                partyBperson: {
                    required:true
                },
                start: {
                    required:true
                },
                signAdd: {
                    required:true
                }
            },
            messages: {
                partyAperson: {
                    required:e+"请输入合同甲方经办人"
                },
                partyBperson: {
                    required:e+"请输入合同乙方经办人"
                },
                start: {
                    required:e+"请输入签订日期"
                },
                signAdd: {
                    required:e+"请输入签订地址"
                }
            }
        });
    });

    function queryRentInfo()
    {
        /*租房信息列表*/
        $("#rentInfoTable").jqGrid({
            url: '../../../rentalDraft/rental/queryRentInfo',
            postData:{
                appNo : appNo
            },
            datatype : "json",
            height: 150,
            autowidth: true,
            shrinkToFit: true,
            colNames : ['租赁地址', '房屋面积(㎡)', '租赁日期' , '租金计算类型', '单价(平方/天*元)'],
            colModel : [
                {name : 'houseAddr',  index : 'houseAddr',width : 380,  align : "center"},
                {name : 'totalArea',     index : 'totalArea',   width : 110,  align : "center"},
                {name : 'rentDate',  index : 'rentDate',width : 180,  align : "center"},
                {name : 'baCalcMode',     index : 'baCalcMode',   width : 110,  align : "center", hidden:true},
                {name : 'unitPrice',     index : 'unitPrice',   width : 120,  align : "center"}
            ],
            rowNum : 10,
            rowList : [ 10, 20, 30 ],
            pager : '#rentInfoPager',
            viewrecords: true,
            rownumbers: true,
            //multiselect : true,
            caption : "",
            hidegrid: false
        });
        $("#rentInfoTable").jqGrid("navGrid", "#rentInfoPager", {
                    add: false,
                    edit: false,
                    del: false,
                    search: false
                },
                {
                    height: 200,
                    reloadAfterSubmit: true
                });
    }

    function queryAppContractByAppNo()
    {
        $.ajax({
            url: '../../../rentalDraft/rental/queryAppContractByAppNo',
            data: {
                appNo: appNo
                //groupCode : '0102'
                //groupCode : '0101'
            },
            type: 'post',
            dataType: 'json',
            success: function (data) {
                var sAppContract = data.data;
                /*合同信息*/
                if (null != sAppContract)
                {
                    if(null != sAppContract.partyAperson && '' != sAppContract.partyAperson && undefined != sAppContract.partyAperson)
                    {
                        //合同甲方经办人
                        $('#partyAperson').val(sAppContract.partyAperson);
                    }
                    else
                    {
                        //合同甲方经办人
                        $('#partyAperson').val(sAppContract.userName);
                    }

                    if(null != sAppContract.partyBperson && '' != sAppContract.partyBperson && undefined != sAppContract.partyBperson)
                    {
                        //合同乙方经办人
                        $('#partyBperson').val(sAppContract.partyBperson);
                    }
                    else
                    {
                        //合同乙方经办人
                        $('#partyBperson').val(sAppContract.bizTransactor);
                    }

                    //签订日期
                    $('#start').val(sAppContract.signDate);
                    //签订地址
                    $('#signAdd').val(sAppContract.signAdd);
                }
                else
                {

                    //合同甲方经办人
                    $('#partyAperson').val(sAppContract.userName);
                    //合同乙方经办人
                    $('#partyBperson').val(sAppContract.bizTransactor);

                }
            },
            error: function () {

                layer.alert("查询异常！");
            }
        });
    }

    function queryHistory() {
        $.ajax({
            url: '../../../rentalDraft/rental/queryHistoryForNew',
            data: {
                appNo: appNo

                //groupCode : '0102'
                //groupCode : '0101'
            },
            type: 'post',
            dataType: 'json',
            success: function (data) {
                var rentalDraftInfo = data.data;

                if(null != rentalDraftInfo)
                {
                    /*租赁申请信息*/
                    $("#consNameId").val(rentalDraftInfo.consName);
                    //业务办理人
                    $('#bizTransactor_id').val(rentalDraftInfo.bizTransactor);
                    //联系电话
                    $('#contactTel_id').val(rentalDraftInfo.contactTel);
                    //通讯地址
                    $('#contactAdd_id').val(rentalDraftInfo.contactAdd);
                    //租赁总面积
                    $('#houseArea_id').val(rentalDraftInfo.houseArea);
                    //租赁地址
                    $('#consAddr_id').val(rentalDraftInfo.consAddr);


                    //缴费方式
                    $('#payMode_id').val(rentalDraftInfo.payMode);
                    //缴费方式
                    $('#payMode_id1').val(rentalDraftInfo.payMode);
                    //押金
                    $('#deposit_id').val(rentalDraftInfo.deposit);
                    //押金-2
                    $('#deposit_id1').val(rentalDraftInfo.deposit);
                    //备注
                    $('#remark_id').val(rentalDraftInfo.remark);
                    //备注-2
                    $('#remark_id1').val(rentalDraftInfo.remark);
                    //付款周期
                    $('#billCycle_id').val(rentalDraftInfo.billCycle);
                    //付款周期
                    $('#billCycle_id1').val(rentalDraftInfo.billCycle);
                    //开户协议号
                    $('#acctAgmtNo_id').val(rentalDraftInfo.acctAgmtNo);
                    //缴费账号
                    $('#bankAcct_id').val(rentalDraftInfo.bankAcct);
                    // 账户名称
                    $('#acctName_id').val(rentalDraftInfo.acctName);
                    //开户银行
                    $('#bankCode_id').val(rentalDraftInfo.bankCode);

                    if(null != rentalDraftInfo.payMode && '' != rentalDraftInfo.payMode && undefined != rentalDraftInfo.payMode)
                    {
                        if('坐收' != rentalDraftInfo.payMode)
                        {
                            $('#payModeId').show();
                            $('#payModeId1').hide();
                        }
                        else
                        {
                            $('#payModeId').hide();
                            $('#payModeId1').show();
                        }
                    }

                    //rentalDraftInfo.custId;
                    //var attachRefList = rentalDraftInfo.attachRefList;

                    //初始化文件盒子
                    //FileBox.init(attachRefList, deleteAttachRef);
                }
            },
            error: function () {

                layer.alert("查询异常！");
            }
        });
    }

    function printScreen()
    {
        $("#chooseDivBody").jqprint();
    }

    function showChooseDiv()
    {
        $("#applyDiv").hide();
        $("#chooseDiv").show();
        generatePayNotice();
        //滚动条滚动到最上面
        window.scrollTo(0,0);
    }

    function generatePayNotice()
    {
        var trs = '';
        trs +=
        '<tr class="gradeX">'+
        '<td>1</td>'+
        '<td>金额(元)</td>'+
        '<td>2011-12-05</td>'+
        '</tr>';

        /*$.each(rentArr, function (index, item) {
            trs +=
            '<tr>' +
            '<td class="project-title"><label title="'+item.contractName+
            '" class="truncateCss" style="width:270px;font-size: 18px;color: #676a6c;font-weight: 600;"><i style="color: #18a689;" class="fa fa-file"></i> &nbsp;&nbsp;' +
            item.contractName+
            '</label><br>' +
            '<label title="'+item.houseAddr+'" class="truncateCss" style="width:270px;font-size: 14px;font-weight:100;">'+
            '<i style="font-size:18px;color: #18a689;" class="fa fa-building"></i>&nbsp;&nbsp;&nbsp;&nbsp;'+
            item.houseAddr+'</label>' +
            '</td>' +
            '<td class="project-completion" style="width: 300px;">' +
            '<i class="fa fa-calendar" style="color: #18a689;"> </i> &nbsp;<label>'+item.bgnDate+'~'+ item.endDate+'</label>' +
            '</td>' +
            '<td style="text-align:left;" class="project-people">';
            trs+='<h4 class="rentCommonTruncateCss" title="暂无附件"> '+
            '<i class="fa fa-paperclip">  </i> &nbsp;暂无附件</h4>';

            trs+='</td>' +
            '<td class="project-actions">' +
            '<button class="btn btn-w-m btn-primary" value="'+item.contractId+'" onclick="showSignInfoDivForNew(this);">'+
            '<i class="fa fa-pencil"></i>&nbsp;&nbsp; 编&nbsp;辑 </button>' +
            '</td>' +
            '</tr>';

        });*/
        $('#payTableBody').empty();
        $('#payTableBody').append(trs);
    }

    function backToApplyDiv()
    {
        $("#applyDiv").show();
        $("#chooseDiv").hide();
    }

    function validate()
    {
        return $("#signForm").validate().element(document.getElementsByName("partyAperson"))&&
         $("#signForm").validate().element(document.getElementsByName("partyBperson"))&&
         $("#signForm").validate().element(document.getElementsByName("start"))&&
         $("#signForm").validate().element(document.getElementsByName("signAdd"));
    }

    function saveProcess()
    {
        if(drafNum > 1)
        {
            doProcess();
        }
        else
        {
            save();
        }
    }

    function doProcess()
    {
        if(null != $("[name='noSign']") && $("[name='noSign']").length>0)
        {
            layer.alert("还有"+$("[name='noSign']").length+"个合同尚未签订！");
        }
        else
        {
            $.ajax({
                url: '../../../rentalDraft/rental/saveSignProcess',
                data: {
                    'appNo' : appNo
                },
                type: 'post',
                dataType: 'json',
                success: function (data) {

                    if(data.status == 0)
                    {
                        layer.alert("流程流转成功!");

                        parent.$.workflow.completeTask();
                    }
                    else
                    {
                        layer.alert("流程流转异常!");
                    }
                },
                error: function () {
                    layer.alert("流程流转异常!");

                }
            });
        }
    }

    function save()
    {
        if (!validate())
        {
            return;
        }

        if(lastSel)
        {
            //$("#contractId").click();

            jQuery("#acctPlanTable").saveRow(lastSel, false, 'clientArray');
        }

        var rowDatas = $("#acctPlanTable").jqGrid("getRowData");

        var accPlanArray = '';

        for(var i = 0; i < rowDatas.length; i++)
        {
            var appTcpId = rowDatas[i].appTcpId;
            var planRunTime = rowDatas[i].planRunTime;

            accPlanArray = accPlanArray + appTcpId;
            accPlanArray = accPlanArray + '_';
            accPlanArray = accPlanArray + planRunTime;
            if(i != rowDatas.length - 1)
            {
                accPlanArray = accPlanArray + ',';
            }
        }

        $.ajax({
            url: '../../../rentalDraft/rental/saveRentalSign',
            data: {
                'partyAperson': $('#partyAperson').val(),
                'partyBperson': $('#partyBperson').val(),
                'signDate': $('#start').val(),
                'signAdd': $('#signAdd').val(),
                'appNo' : appNo,
                'attachIds' : $("#attachIdsIn").val(),
                        'contractId' :$("#contractIdSign").val(),
                        'accPlanArray' : accPlanArray
            },
            type: 'post',
            dataType: 'json',
            success: function (data) {
                if(data.status == 0)
                {
                    $("#attachIdsIn").val("");

                    layer.alert("保存成功!");
                    if(drafNum>1)
                    {
                        queryRentInfoForSign();
                        $("#applyDiv").show();
                        $("#signDiv").hide();
                    }
                    else
                    {
                        doProcess();
                    }
                }
                else
                {
                    layer.alert("保存异常!");
                }
            },
            error: function () {
                layer.alert("保存异常!");
            }
        });
    }

    //图上传成功
    function uploadImgSuccess(json)
    {
        if ("0" == json.status)
        {
            var attachId = json.data;
            var attachIds = $("#attachIdsIn").val();
            if (isEmpty($("#attachIdsIn").val()))
            {
                $("#attachIdsIn").val(attachId);
            }
            else
            {
                $("#attachIdsIn").val(attachIds + "," + attachId);
            }
        }
    }

    //判断字符串是否为空、undefined、''
    function isEmpty(obj)
    {
        if (undefined == obj || null == obj
                || 'null' == obj || '' == obj)
        {
            return true;
        }
        return false;
    }

    function deleteAttachRef(data)
    {
        var layerIndex = layer.confirm('确定要删除该图片？', {
            btn: ['是','否'], //按钮
            icon: 3
        }, function(){
            //删除与图片关联关系
            $.ajax({
                type: "POST",
                url: "/system/attachRef/deleteAttachRefsById",
                data: data,
                success: function(json){
                    if ('0' == json.status)
                    {
                        //删除文件
                        FileBoxSign.deleteFile(data.attachRefId);
                    }
                    else
                    {
                        layer.alert(json.msg, {icon: 0});
                    }
                    layer.close(layerIndex);
                }
            });
        }, function(){

        });
    }

    var start = {
        elem: '#start',
        format: 'YYYY/MM/DD',
        min: '1900-01-01 00:00:00', //设定最小日期为当前日期
        max: laydate.now(), //最大日期
        istime: false,
        istoday: false,
        choose: function(datas){
            $("#signForm").validate().element(document.getElementsByName("start"));
        }
    };

    laydate(start);

    function queryRentInfoForSign()
    {
        $.ajax({
            url: '../../../rentalDraft/rental/queryRentInfoForSign',
            data: {
                appNo : appNo
            },
            type: 'post',
            dataType: 'json',
            success: function (data) {
                showSignsForNew(data.data);
            },
            error: function () {
                layer.alert("保存异常!");

            }
        });
    }

    var drafNum = 0;
    function showSignsForNew(rentArr)
    {
        drafNum = rentArr.length;
        if(rentArr.length>1)
        {
            var trs = '';
            trs += '<thead>'+
            '<tr>'+
            '<th>状态</th>'+
            '<th>合同名称</th>'+
            '<th>用户名称</th>'+
            '<th>租赁地址</th>'+
            '<th>操作</th>'+
            '</tr>'+
            '</thead>';
            $.each(rentArr, function (index, item) {
                trs +=
                        '<tr>' +
                        '<td class="project-status" style="width: 100px;">';
                if(null == item.signDate ||"" == item.signDate)
                {
                    trs+='<span  name="noSign" class="label label-default">未签订</span>';
                }else
                {
                    trs+='<span class="label label-primary">已签订</span>';

                }
                trs+='</td>' +
                '<td class="project-title   col-sm-3"><label title="'+item.contractName+
                '" class="truncateCss" style="max-width: 200px;font-size: 18px;color: #676a6c;font-weight: 600;"><i style="" class="fa fa-file"></i> &nbsp;&nbsp;' +
                item.contractName+
                '</label>' +
                '</td>' +
                '<td class="project-completion   col-sm-3">' +
                '<label title="'+$("#consNameId").val()+'" class="truncateCss" style="max-width: 200px;font-size: 14px;font-weight:100;">'+
                '<i style="font-size:18px;" class="fa fa-user"></i>&nbsp;&nbsp;&nbsp;&nbsp;'+
                $("#consNameId").val()+'</label>' +
                '</td>' +
                '<td class="project-completion   col-sm-3">' +
                '<label title="'+item.houseAddr+'" class="truncateCss" style="max-width: 200px;font-size: 14px;font-weight:100;">'+
                '<i style="font-size:18px;" class="fa fa-building"></i>&nbsp;&nbsp;&nbsp;&nbsp;'+
                item.houseAddr+'</label>' +
                '</td>';
                /*  '<td style="text-align:left;" class="project-people">'
                 if(null != item.attachRefList && undefined != item.attachRefList && item.attachRefList.length>0)
                 {
                 trs+='<h4 class="rentCommonTruncateCss" title="'+item.attachRefList[0].dataFile.fileName+'">'+
                 '<i class="fa fa-paperclip">  </i> &nbsp;'+
                 '<a style="text-decoration:underline;color: #0000cc;" href=" '+item.attachRefList[0].url+'">'
                 +item.attachRefList[0].dataFile.fileName+
                 '</a>';
                 }else
                 {
                 trs+='<h4 class="rentCommonTruncateCss" title="暂无附件"> '+
                 '<i class="fa fa-paperclip">  </i> &nbsp;暂无附件</h4>';
                 }'</td>' +*/
                trs+=
                '<td class="project-actions">' +
                '<button class="btn btn-w-m btn-primary" value="'+item.contractId+'" onclick="showSignInfoDivForNew(this);">'+
                '<i class="fa fa-pencil"></i>&nbsp;&nbsp; 编&nbsp;辑 </button>' +
                '</td>' +
                '</tr>';

            });
            $('#signTable').empty();
            $('#signTable').append(trs);
        }else
        {
            $("#signsDiv").remove();
            $("#signDiv").show();
            $("#applyDiv").css("padding-bottom",'0px');
            $("#signDiv").css("padding-top",'0px');
            $("#backBtn").hide();
            $("#saveBtn").hide();
//            $("#draftDiv").insertAfter($("#baseInfo"));
            var contractObj = rentArr[0];
            showSignInfoDivForSingle(contractObj.contractId)
        }
    }

    function showSignInfoDivForSingle(contractId)
    {
        resetSignDiv();
        $("#contractIdSign").val(contractId);
//        $("#applyDiv").hide();
//        $("#signDiv").show();
        if("" != $("#contractIdSign").val())
        {
            $.ajax({
                url: '../../../rentalDraft/rental/queryAppContractByAppNo',
                data: {
                    appNo: appNo,
                    belongId: contractId + '_02',
                    contractId: contractId
                },
                type: 'post',
                dataType: 'json',
                success: function (data) {
                    var sAppContract = data.data.sAppContract;
                    var attachRefArr = data.data.attachRefList;

                    initAccPlan(contractId);

                    /*合同信息*/
                    if (null != sAppContract)
                    {
                        if(null != sAppContract.partyAperson && '' != sAppContract.partyAperson && undefined != sAppContract.partyAperson)
                        {
                            //合同甲方经办人
                            $('#partyAperson').val(sAppContract.partyAperson);
                        }
                        else
                        {
                            //合同甲方经办人
                            $('#partyAperson').val(sAppContract.userName);
                        }

                        if(null != sAppContract.partyBperson && '' != sAppContract.partyBperson && undefined != sAppContract.partyBperson)
                        {
                            //合同乙方经办人
                            $('#partyBperson').val(sAppContract.partyBperson);
                        }
                        else
                        {
                            //合同乙方经办人
                            $('#partyBperson').val(sAppContract.bizTransactor);
                        }

                        //签订日期
                        $('#start').val(sAppContract.signDate);
                        //签订地址
                        $('#signAdd').val(sAppContract.signAdd);
                    }
                    else
                    {

                        //合同甲方经办人
                        $('#partyAperson').val(sAppContract.userName);
                        //合同乙方经办人
                        $('#partyBperson').val(sAppContract.bizTransactor);

                    }

                    if(null != attachRefArr && attachRefArr.length>0)
                    {
                        //初始化文件盒子
                        FileBoxSign.init(attachRefArr, deleteAttachRef);
                    }
                    showDraftInfoDivForSingle(contractId);
                },
                error: function () {

                    layer.alert("查询异常！");
                }
            });
        }
    }


    function showDraftInfoDivForSingle(contractId)
    {
        resetDraftDiv();
        $("#contractId").val(contractId);
        if("" != contractId)
        {
            $.ajax( {
                url:'../../../rentalDraft/rental/queryDraftInfoById',
                data:{
                    contractId:$("#contractId").val(),
                    belongId:$("#contractId").val()+'_01',
                    appNo:appNo
                },
                type:'post',
                dataType:'json',
                success:function(data) {
                    var attachRefArr = data.data.attachRefList;
                    var sAppContractArr = data.data.sAppContractList;
                    //逐一回填
                    /*合同信息*/
                    if(sAppContractArr.length>0)
                    {
                        var sAppContract = sAppContractArr[0];

                        if (null != sAppContract) {
                            //合同名称
                            $('#contractName').val(sAppContract.contractName);
                            //甲方
                            $('#contractOwner').val(sAppContract.partyA);
                            //乙方
                            $('#contractGuest').val(sAppContract.partyB);
                        }
                    }else
                    {
                        $('#contractName').val("房屋租赁合同");
                    }

                    if(attachRefArr.length>0)
                    {
                        //初始化文件盒子
                        FileBox.init(attachRefArr, deleteAttachRef);
                    }
                },
                error : function() {
                    alert("异常！");
                }
            });
        }
    }



//    function showSignsForNew(rentArr)
//    {
//        var trs = '';
//        $.each(rentArr, function (index, item) {
//            if(item.contractName == null)
//            {
//                item.contractName ="房屋租赁合同";
//            }
//
//            trs +=
//                    '<tr>' +
//                    '<td class="project-title"><label title="'+item.contractName+
//                    '" class="truncateCss" style="width:270px;font-size: 18px;color: #676a6c;font-weight: 600;"><i style="color: #18a689;" class="fa fa-file"></i> &nbsp;&nbsp;' +
//                    item.contractName+
//                    '</label><br>' +
//                    '<label title="'+item.houseAddr+'" class="truncateCss" style="width:270px;font-size: 14px;font-weight:100;">'+
//                    '<i style="font-size:18px;color: #18a689;" class="fa fa-building"></i>&nbsp;&nbsp;&nbsp;&nbsp;'+
//                    item.houseAddr+'</label>' +
//                    '</td>' +
//                    '<td class="project-completion" style="width: 300px;">' +
//                    '<i class="fa fa-calendar" style="color: #18a689;"> </i> &nbsp;<label>'+item.bgnDate+'~'+ item.endDate+'</label>' +
//                    '</td>' +
//                    '<td style="text-align:left;" class="project-people">';
//            if(null != item.attachRefList && undefined != item.attachRefList && item.attachRefList.length>0)
//            {
//                trs+='<h4 class="rentCommonTruncateCss" title="'+item.attachRefList[0].dataFile.fileName+'">'+
//                '<i class="fa fa-paperclip">  </i> &nbsp;'+
//                '<a style="text-decoration:underline;color: #0000cc;" href=" '+item.attachRefList[0].url+'">'
//                +item.attachRefList[0].dataFile.fileName+
//                '</a>';
//            }else
//            {
//                trs+='<h4 class="rentCommonTruncateCss" title="暂无附件"> '+
//                '<i class="fa fa-paperclip">  </i> &nbsp;暂无附件</h4>';
//            }
//
//            trs+='</td>' +
//            '<td class="project-actions">' +
//            '<button class="btn btn-w-m btn-primary" value="'+item.contractId+'" onclick="showSignInfoDivForNew(this);">'+
//            '<i class="fa fa-pencil"></i>&nbsp;&nbsp; 编&nbsp;辑 </button>' +
//            '</td>' +
//            '</tr>';
//
//        });
//        $('#signTable').empty();
//        $('#signTable').append(trs);
//    }

    function showSignInfoDivForNew(me)
    {
        resetSignDiv();
        var contractId = me.value;
        $("#contractIdSign").val(contractId);
        $("#applyDiv").hide();
        $("#signDiv").show();
        if("" != $("#contractIdSign").val())
        {
            $.ajax({
                url: '../../../rentalDraft/rental/queryAppContractByAppNo',
                data: {
                    appNo: appNo,
                    belongId: contractId + '_02',
                    contractId: contractId
                },
                type: 'post',
                dataType: 'json',
                success: function (data) {
                    var sAppContract = data.data.sAppContract;
                    var attachRefArr = data.data.attachRefList;
					
					initAccPlan(contractId);

                    /*合同信息*/
                    if (null != sAppContract)
                    {
                        if(null != sAppContract.partyAperson && '' != sAppContract.partyAperson && undefined != sAppContract.partyAperson)
                        {
                            //合同甲方经办人
                            $('#partyAperson').val(sAppContract.partyAperson);
                        }
                        else
                        {
                            //合同甲方经办人
                            $('#partyAperson').val(sAppContract.userName);
                        }

                        if(null != sAppContract.partyBperson && '' != sAppContract.partyBperson && undefined != sAppContract.partyBperson)
                        {
                            //合同乙方经办人
                            $('#partyBperson').val(sAppContract.partyBperson);
                        }
                        else
                        {
                            //合同乙方经办人
                            $('#partyBperson').val(sAppContract.bizTransactor);
                        }

                        //签订日期
                        $('#start').val(sAppContract.signDate);
                        //签订地址
                        $('#signAdd').val(sAppContract.signAdd);
                    }
                    else
                    {

                        //合同甲方经办人
                        $('#partyAperson').val(sAppContract.userName);
                        //合同乙方经办人
                        $('#partyBperson').val(sAppContract.bizTransactor);

                    }

                    if(null != attachRefArr && attachRefArr.length>0)
                    {
                        //初始化文件盒子
                        FileBoxSign.init(attachRefArr, deleteAttachRef);
                    }
                    showDraftInfoDivForNew(me);
                },
                error: function () {

                    layer.alert("查询异常！");
                }
            });
        }
    }

    function showSigns(rentArr)
    {
        var rentsNo = 0;
        var pageNum = Math.ceil(rentArr.length/3);
        if(pageNum ==0)
        {
            pageNum = 1;
        }
        $("#rentItemsDiv").empty();
        for(var i=0;i<pageNum;i++)
        {
            var html4 = "";
            html4 += '<div class="item">';
            html4 += '<div class="row">';
            for (var j = 0; j < 3; j++)
            {
                if(rentsNo<rentArr.length)
                {
                    var rentInfoObj = rentArr[rentsNo];
                    var html5 = "";
                    html5 += '<div class="col-lg-4">';
                    var backHtml = getHtmlSign(rentInfoObj);
                    html5 += backHtml;
                    html5 += '</div>';
                    html4 += html5;
                }
                rentsNo++;
            }
            html4 += '</div>';
            html4 += '</div>';
            $("#rentItemsDiv").append(html4);
        }
        $("#rentItemsDiv .item:first").addClass("active");
        //删除产生的空行
        if(rentArr.length != 0)
        {
            $("#rentItemsDiv .item .row:empty").parent().remove();
        }
    }

    function getHtmlSign(data)
    {
        if(data.contractName == null)
        {
            data.contractName ="请完善合同名称！";
        }
        var html = "";
        html+=' <div class="contact-box">';
        html+='   <div class="col-sm-12" style="cursor:pointer;"  onclick="showSignInfoDiv(this);">';
        html+='<input  id="contractIdClass" class="contractIdClass" type="text" value="'+data.contractId+'" style="display:none;">';
        html+='       <h3 class="rentCommonTruncaCss" title="'+data.houseAddr+'"><strong class="houseAddr"> <i class="fa fa-building"> </i> &nbsp;'+data.houseAddr+'</strong></h3>';
        html+='       <div style="margin-top:25px;">';
        html+='           <h4 class="rentCommonTruncaCss" title="'+data.bgnDate+'~'+data.endDate+'"> <i class="fa fa-calendar"> </i> &nbsp;&nbsp;'+data.bgnDate+'~'+data.endDate+'</h4>';
        html+='       </div>';
        html+='       <div style="margin-top:25px;">';
        html+='            <h4 class="rentCommonTruncaCss" title="'+data.contractName+'"> <i class="fa fa-file">  </i> &nbsp;'+data.contractName+'</h4>';
        html+='       </div>';
        html+='       <div style="margin-top:25px;">';
        if(null != data.attachRefList && undefined != data.attachRefList && data.attachRefList.length>0)
        {
            html+='<h4 class="rentCommonTruncaCss" title="'+data.attachRefList[0].dataFile.fileName+'"> <i class="fa fa-paperclip">  </i> &nbsp;<a style="text-decoration:underline;color: #0000cc;" href=" '+data.attachRefList[0].url+'">'+data.attachRefList[0].dataFile.fileName+'</a>';
        }else
        {
            html+='<h4 class="rentCommonTruncaCss" title="暂无附件"> <i class="fa fa-paperclip">  </i> &nbsp;暂无附件</h4>';
        }
        html+='       </div>';
        html+='   </div>';
        html+='   <div class="clearfix"></div>';
        html+='</div>';
        return html;
    }

    //切换至合同页面
    var selectedSignItem ;
    function showSignInfoDiv(me)
    {
        resetSignDiv();
        selectedSignItem = me;
        var contractId = $(me).find(".contractIdClass")[0].value;
        $("#contractIdSign").val(contractId);
        $("#applyDiv").hide();
        $("#signDiv").show();
        if("" != $("#contractIdSign").val())
        {
            $.ajax({
                url: '../../../rentalDraft/rental/queryAppContractByAppNo',
                data: {
                    appNo: appNo,
                    belongId: contractId + '_02',
                    contractId: contractId
                },
                type: 'post',
                dataType: 'json',
                success: function (data) {
                            initAccPlan(contractId);
                    var sAppContract = data.data.sAppContract;
                    var attachRefArr = data.data.attachRefList;

                    /*合同信息*/
                    if (null != sAppContract)
                    {
                        if(null != sAppContract.partyAperson && '' != sAppContract.partyAperson && undefined != sAppContract.partyAperson)
                        {
                            //合同甲方经办人
                            $('#partyAperson').val(sAppContract.partyAperson);
                        }
                        else
                        {
                            //合同甲方经办人
                            $('#partyAperson').val(sAppContract.userName);
                        }

                        if(null != sAppContract.partyBperson && '' != sAppContract.partyBperson && undefined != sAppContract.partyBperson)
                        {
                            //合同乙方经办人
                            $('#partyBperson').val(sAppContract.partyBperson);
                        }
                        else
                        {
                            //合同乙方经办人
                            $('#partyBperson').val(sAppContract.bizTransactor);
                        }

                        //签订日期
                        $('#start').val(sAppContract.signDate);
                        //签订地址
                        $('#signAdd').val(sAppContract.signAdd);
                    }
                    else
                    {

                        //合同甲方经办人
                        $('#partyAperson').val(sAppContract.userName);
                        //合同乙方经办人
                        $('#partyBperson').val(sAppContract.bizTransactor);

                    }

                    if(null != attachRefArr && attachRefArr.length>0)
                    {
                        //初始化文件盒子
                        FileBoxSign.init(attachRefArr, deleteAttachRef);
                    }
                },
                error: function () {

                    layer.alert("查询异常！");
                }
            });
        }
    }

    function getImgHtmlSign()
    {
        var  html =
                '<div id="img-groupSign">'+
                '<div class="form-group">'+
                '<label class="col-sm-2 control-label">合同扫描件</label>'+
                '<div class="col-sm-10">'+
                '<div id="fileboxSign">'+
                '<ul class="filelist lightBoxGallery">'+
                '</ul>'+
                '<div id="blueimp-gallerySign" class="blueimp-gallery">'+
                '<div class="slides"></div>'+
                '<h3 class="title"></h3>'+
                '<a class="prev">‹</a>'+
                '<a class="next">›</a>'+
                '<a class="close">×</a>'+
                '<a class="play-pause"></a>'+
                '<ol class="indicator"></ol>'+
                '</div>'+
                '</div>'+
                '</div>'+
                '</div>'+
                '</div>'+
                '<div id="uploader" class="wu-example">'+
                '<div class="queueList">'+
                '<div id="dndArea" class="placeholder">'+
                '<div id="filePicker"></div>'+
                '<p></p>'+
                '</div>'+
                '</div>'+
                '<div class="statusBar" style="display:none;">'+
                '<div class="progress">'+
                '<span class="text">0%</span>'+
                '<span class="percentage"></span>'+
                '</div><div class="info"></div>'+
                '<div class="btns">'+
                '<div id="filePicker2"></div><div class="uploadBtn">开始上传</div>'+
                '</div>'+
                '</div>'+
                '</div>';
        return html;
    }

    function backToMainDivSign()
    {
        $("#signDiv").hide();
        $("#applyDiv").show();
    }

    function resetSignDiv()
    {
        $('#attachIdsIn').val("");
        $('#partyAperson').val("");
        $('#partyBperson').val("");
        $("#start").val("");
        $("#signAdd").val("");

        $("#img-groupSign").remove();
        $("#uploader").remove();
        //重新初始化图片上传控件
        var  html = getImgHtmlSign();
        $("#imgTopHrSign").after(html);

        $.getScript("../../../js/rental/buildingRent/uploaderSign.js");
        $.getScript("../../../js/rental/buildingRent/filebox.js");
        //$.getScript("../../../js/rental/buildingRent/jquery.blueimp-gallery.min.js");
    }

//    function queryRentInfoForDraft()
//    {
//        $.ajax({
//            url: '../../../rentalDraft/rental/queryRentInfoForDraft',
//            data: {
//                appNo : appNo
//            },
//            type: 'post',
//            dataType: 'json',
//            success: function (data) {
//                //showDrafts(data.data);
//                showDraftsForNew(data.data);
//            },
//            error: function () {
//                layer.alert("保存异常!");
//
//            }
//        });
//    }

//    function showDraftsForNew(rentArr)
//    {
//        var trs = '';
//        $.each(rentArr, function (index, item) {
//            if(item.contractName == null)
//            {
//                item.contractName ="房屋租赁合同";
//            }
//
//            trs +=
//                    '<tr>' +
//                    '<td class="project-title"><label title="'+item.contractName+
//                    '" class="truncateCss" style="width:270px;font-size: 18px;color: #676a6c;font-weight: 600;"><i style="color: #18a689;" class="fa fa-file"></i> &nbsp;&nbsp;' +
//                    item.contractName+
//                    '</label><br>' +
//                    '<label title="'+item.houseAddr+'" class="truncateCss" style="width:270px;font-size: 14px;font-weight:100;">'+
//                    '<i style="font-size:18px;color: #18a689;" class="fa fa-building"></i>&nbsp;&nbsp;&nbsp;&nbsp;'+
//                    item.houseAddr+'</label>' +
//                    '</td>' +
//                    '<td class="project-completion" style="width: 300px;">' +
//                    '<i class="fa fa-calendar" style="color: #18a689;"> </i> &nbsp;<label>'+item.bgnDate+'~'+ item.endDate+'</label>' +
//                    '</td>' +
//                    '<td style="text-align:left;" class="project-people">';
//            if(null != item.attachRefList && undefined != item.attachRefList && item.attachRefList.length>0)
//            {
//                trs+='<h4 class="rentCommonTruncateCss" title="'+item.attachRefList[0].dataFile.fileName+'">'+
//                '<i class="fa fa-paperclip">  </i> &nbsp;'+
//                '<a style="text-decoration:underline;color: #0000cc;" href=" '+item.attachRefList[0].url+'">'
//                +item.attachRefList[0].dataFile.fileName+
//                '</a>';
//            }else
//            {
//                trs+='<h4 class="rentCommonTruncateCss" title="暂无附件"> '+
//                '<i class="fa fa-paperclip">  </i> &nbsp;暂无附件</h4>';
//            }
//
//            trs+='</td>' +
//            '<td class="project-actions">' +
//            '<button class="btn btn-w-m btn-primary" value="'+item.contractId+'" onclick="showDraftInfoDivForNew(this);">'+
//            '<i class="fa fa-pencil"></i>&nbsp;&nbsp; 查&nbsp;看 </button>' +
//            '</td>' +
//            '</tr>';
//
//        });
//        $('#draftsTable').empty();
//        $('#draftsTable').append(trs);
//    }

    //切换至合同页面
    function showDraftInfoDivForNew(me)
    {
        resetDraftDiv();
        $("#contractId").val(me.value);
        $("#applyDiv").hide();
        $("#draftDiv").show();
        if("" != $("#contractId").val())
        {
            $.ajax( {
                url:'../../../rentalDraft/rental/queryDraftInfoById',
                data:{
                    contractId:$("#contractId").val(),
                    belongId:$("#contractId").val()+'_01',
                    appNo:appNo
                },
                type:'post',
                dataType:'json',
                success:function(data) {
                    var attachRefArr = data.data.attachRefList;
                    var sAppContractArr = data.data.sAppContractList;
                    //逐一回填
                    /*合同信息*/
                    if(sAppContractArr.length>0)
                    {
                        var sAppContract = sAppContractArr[0];

                        if (null != sAppContract) {
                            //合同名称
                            $('#contractName').val(sAppContract.contractName);
                            //甲方
                            $('#contractOwner').val(sAppContract.partyA);
                            //乙方
                            $('#contractGuest').val(sAppContract.partyB);
                        }
                    }

                    if(attachRefArr.length>0)
                    {
                        FileBox.showDelBtn = false;

                        //初始化文件盒子
                        FileBox.init(attachRefArr, deleteAttachRef);
                    }
                },
                error : function() {
                    alert("异常！");
                }
            });
        }
    }

    function showDrafts(rentArr)
    {
        var rentsNo = 0;
        var pageNum = Math.ceil(rentArr.length/3);
        if(pageNum ==0)
        {
            pageNum = 1;
        }
        $("#rentItemsDiv1").empty();
        for(var i=0;i<pageNum;i++)
        {
            var html4 = "";
            html4 += '<div class="item">';
            html4 += '<div class="row">';
            for (var j = 0; j < 3; j++)
            {
                if(rentsNo<rentArr.length)
                {
                    var rentInfoObj = rentArr[rentsNo];
                    var html5 = "";
                    html5 += '<div class="col-lg-4">';
                    var backHtml = getHtml3(rentInfoObj);
                    html5 += backHtml;
                    html5 += '</div>';
                    html4 += html5;
                }
                rentsNo++;
            }
            html4 += '</div>';
            html4 += '</div>';
            $("#rentItemsDiv1").append(html4);
        }
        $("#rentItemsDiv1 .item:first").addClass("active");
        //删除产生的空行
        if(rentArr.length != 0)
        {
            $("#rentItemsDiv1 .item .row:empty").parent().remove();
        }
    }

    function getHtml3(data)
    {
        if(data.contractName == null)
        {
            data.contractName ="请完善合同名称！";
        }
        var html = "";
        html+=' <div class="contact-box">';
        html+='   <div class="col-sm-12" style="cursor:pointer;"  onclick="showDraftInfoDiv(this);">';
        html+='<input class="contractIdClass" type="text" value="'+data.contractId+'" style="display:none;">';
        html+='       <h3 class="rentCommonTruncaCss" title="'+data.houseAddr+'"><strong class="houseAddr"> <i class="fa fa-building"> </i> &nbsp;'+data.houseAddr+'</strong></h3>';
        html+='       <div style="margin-top:25px;">';
        html+='           <h4 class="rentCommonTruncaCss" title="'+data.bgnDate+'~'+data.endDate+'"> <i class="fa fa-calendar"> </i> &nbsp;&nbsp;'+data.bgnDate+'~'+data.endDate+'</h4>';
        html+='       </div>';
        html+='       <div style="margin-top:25px;">';
        html+='            <h4 class="rentCommonTruncaCss" title="'+data.contractName+'"> <i class="fa fa-file">  </i> &nbsp;'+data.contractName+'</h4>';
        html+='       </div>';
        html+='       <div style="margin-top:25px;">';
        if(null != data.attachRefList && undefined != data.attachRefList && data.attachRefList.length>0)
        {
            html+='<h4 class="rentCommonTruncaCss" title="'+data.attachRefList[0].dataFile.fileName+'"> <i class="fa fa-paperclip">  </i> &nbsp;<a style="text-decoration:underline;color: #0000cc;" href=" '+data.attachRefList[0].url+'">'+data.attachRefList[0].dataFile.fileName+'</a>';
        }else
        {
            html+='<h4 class="rentCommonTruncaCss" title="暂无附件"> <i class="fa fa-paperclip">  </i> &nbsp;暂无附件</h4>';
        }
        html+='       </div>';
        html+='   </div>';
        html+='   <div class="clearfix"></div>';
        html+='</div>';
        return html;
    }

    //切换至合同页面
    var selectedDraftItem ;
    function showDraftInfoDiv(me)
    {
        resetDraftDiv();
        selectedDraftItem = me;
        var contractId = $(me).find(".contractIdClass")[0].value;
        $("#contractId").val(contractId);
        $("#applyDiv").hide();
        $("#draftDiv").show();
        if("" != $("#contractId").val())
        {
            $.ajax( {
                url:'../../../rentalDraft/rental/queryDraftInfoById',
                data:{
                    contractId:$("#contractId").val(),
                    belongId:$("#contractId").val()+'_01',
                    appNo:appNo
                },
                type:'post',
                dataType:'json',
                success:function(data) {
                    var attachRefArr = data.data.attachRefList;
                    var sAppContractArr = data.data.sAppContractList;
                    //逐一回填
                    /*合同信息*/
                    if(sAppContractArr.length>0)
                    {
                        var sAppContract = sAppContractArr[0];

                        if (null != sAppContract) {
                            //合同名称
                            $('#contractName').val(sAppContract.contractName);
                            //甲方
                            $('#contractOwner').val(sAppContract.partyA);
                            //乙方
                            $('#contractGuest').val(sAppContract.partyB);
                        }
                    }

                    if(attachRefArr.length>0)
                    {
                        FileBox.showDelBtn = false;

                        //初始化文件盒子
                        FileBox.init(attachRefArr, deleteAttachRef);
                    }
                },
                error : function() {
                    alert("异常！");
                }
            });
        }
    }

    function getImgHtml()
    {
        var  html =
                '<div id="img-group">'+
                '<div class="form-group">'+
                '<label class="col-sm-2 control-label">合同附件</label>'+
                '<div class="col-sm-10">'+
                '<div id="filebox">'+
                '<ul class="filelist"></ul>'+
                '</div>'+
                '</div>'+
                '</div>'+
                '</div>';
        return html;
    }

//    function backToMainDiv()
//    {
//        $("#draftDiv").hide();
//        $("#applyDiv").show();
//    }

    function resetDraftDiv()
    {
        $('#contractName').val("");
        //甲方
        $('#contractOwner').val("");
        //乙方
        $('#contractGuest').val("");
        $("#attachIdsIn").val("");
        $("#img-group").remove();
        //$("#uploader").remove();
        //重新初始化图片上传控件
        var  html = getImgHtml();
        $("#imgTopHr").after(html);
        //$.getScript("../../../js/rental/buildingRent/uploaderSign.js");
    }

    var lastSel;
    function initAccPlan(contractId)
    {
        resetForAccPlan();

        $("#acctPlanTable").jqGrid({
            url: '../../../rentalDraft/rental/queryForSAppTransAcctPlanForEdit',
            postData:{
                contractId : contractId
            },
            //cellEdit: true,
            cellsubmit: 'remote',
            //cellurl: 'alert("11")',
            datatype : "json",
            height: 150,
            autowidth: true,
            shrinkToFit: true,
            colNames : ['申请扣款计划标识', '费用类别', '扣款金额','扣款时间'],
            colModel : [
                {name : 'appTcpId',  index : 'appTcpId',width : 160,  align : "center", hidden: true},
                {name : 'amtType',  index : 'amtType',width : 160,  align : "center", hidden: false},
                {name : 'transAcctAmt',  index : 'transAcctAmt',   width : 160,  align : "center"},
                {name : 'planRunTime',  index : 'planRunTime', width : 160,  align : "center", editable: true, hidden: false,
                    editoptions:
                    {
                        dataInit: function (element)
                        {
//                            $(element).blur(function ()
//                            {
//                                setTimeout(function(){
//
//                                    jQuery("#acctPlanTable").saveRow(lastSel, false, 'clientArray');
//
//                                },200);
//                            });

                            $(element).datepicker({
                                todayBtn: "linked",
                                keyboardNavigation: false,
                                forceParse: false,
                                calendarWeeks: false,
                                autoclose: true,
                                language: 'zh-CN',
                                //language: 'cn',
                                //showMonthAfterYear:true,
                                format : 'yyyy/mm/dd'
                            }).on('changeDate',function(ev){
                                //var startTime = ev.date.valueOf();
                                //alert(startTime);

                                setTimeout(function(){

                                    jQuery("#acctPlanTable").saveRow(lastSel, false, 'clientArray');

                                },100);
                            });
                        }
                    }
                }
            ],
            rowNum : 10,
            rowList : [ 10, 20, 30 ],
            pager : '#acctPlanPager',
            viewrecords: true,
            rownumbers: true,
            //multiselect : true,
            //multiboxonly : true,
            multikey : true,
            caption : "扣款计划",
            hidegrid: false,
            onSelectRow: function(id){
                if(id && id != lastSel)
                {
                    jQuery("#acctPlanTable").saveRow(lastSel, false, 'clientArray');

                    lastSel = id;
                }
                else
                {
                    jQuery("#acctPlanTable").saveRow("rowid", false, 'clientArray');
                }
                //jQuery('#acctPlanTable').editRow(id, true);

                jQuery("#acctPlanTable").jqGrid('editRow',id,  {
                    "keys" : true,
                    "oneditfunc" : null,
                    "successfunc" : null,
                    "extraparam" : {},
                    "aftersavefunc" : null,
                    "errorfunc": null,
                    "afterrestorefunc" : null,
                    "restoreAfterError" : true,
                    "mtype" : "POST"
                });
            }
        });
        $("#acctPlanTable").jqGrid("navGrid", "#acctPlanPager", {
            add: false,
            edit: false,
            del: false,
            search: false
        },
        {
            height: 150,
            reloadAfterSubmit: true
        });
    }

    function resetForAccPlan()
    {
        $("#accPlanTopHrSignView").remove();

        var html = getImgHtmlAccPlan();

        $("#accPlanTopHrSign").after(html);
    }

    function getImgHtmlAccPlan()
    {
        var html =
                '<div id="accPlanTopHrSignView"  class="form-group">'+
                '<div class="col-sm-12" style="padding: 5px; margin-botton:0px;">' +
                '<div class="jqGrid_wrapper" id="acctPlanTable_id">' +
                '<table id="acctPlanTable"></table>' +
                '<div id="acctPlanPager"></div>' +
                '</div>' +
                '</div>' +
                '</div>';
        return html;
    }
</script>

<!-- 上传图片-->
<script src="../../../js/common/plugins/webuploader/webuploader.js"></script>
<script src="../../../js/common/filebox.js"></script>
<script src="../../../js/rental/buildingRent/uploaderSign.js"></script>
<script src="../../../js/rental/buildingRent/filebox.js"></script>
<script src="../../../js/rental/buildingRent/jquery.blueimp-gallery.min.js"></script>
<!--<script src="../../../js/common/plugins/blueimp/jquery.blueimp-gallery.min.js"></script>-->
</body>

</html>